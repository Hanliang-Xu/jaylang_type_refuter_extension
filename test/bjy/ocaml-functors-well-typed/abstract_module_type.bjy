(***
  (
    (features (Polymorphic_types Dependent_types Modules First_class_types))
    (speed Fast)
    (typing Well_typed)
    (flags "-m 500000") ; increase max step
  )
*)

(*
  This test is taken from OCaml:
    testsuite/tests/typing-modules/functors.ml
*)

(* We don't have "module type of", so we have to write this out *)
let TF = (X : sig
  val witness : type
  val t : type
  val M : t
end) -> X.t

let F : TF = fun X -> X.M

let PF = struct
  let witness = abstract
  let t = TF
  let M = F
end

(* Note: this reaches max step with the default, so we bump it up *)
let U = F(PF)(PF)(PF)(PF)(PF)(PF)
