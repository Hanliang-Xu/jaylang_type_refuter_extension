(***
  (
    (features (Polymorphic_types Dependent_types Modules First_class_types Higher_order_functions Usage_error))
    (reasons (Dependent_types Modules Usage_error))
    (speed Fast)
    (typing Well_typed)
    (flags "")
  )
*)

(*
  This is a well-typed test is adapted from ill-typed OCaml:
    testsuite/tests/typing-modules/functors.ml
*)

let With_expansion
  (dependent A : sig val t : type val M : t end)
  (dependent B : sig val t = A.t end) : B.t = A.M

let R = With_expansion (struct
  let M _ _ = struct end
  let t = unit -> unit -> sig end
end) (struct
  let t = unit -> unit -> sig end
end) () ()