
let color_type = {. int | fun i -> i >= 0 and i < 256 }
in

let point =
  {: x : int
   , y : int
   , deg : int :}
in

let colored_point =
  {: x : int
   , y : int
   , deg : int
   , color : color_type :}
in

let get_color (p : point) : color_type =
  p.color # should have required p : colored_point
in

let (obj : colored_point) =
  let ob =
    fun self ->
      { x = 0
      , y = 0
      , deg = 
          let s = (self self) in
          let tan = s.y / s.x in
          tan - (tan * tan * tan) / 3 + (tan * tan * tan * tan * tan) / 5 # approx arctan with taylor expansion
      , color = 255 }
  in
  ob ob
in

let result = get_color obj # this application is fine. Error is in `get_color` 
in

result
